\documentclass[handout]{beamer}

\input{aulas-beamer-preamble}


\title[Conceitos de Linguagens de Programação]
{%
    Destrutores e herança%
}
\author[Prof. Hugo de Paula]
{
    Prof.~Hugo~de~Paula
}
\institute[DCC / PUC Minas]
{\epsfig{file=puclogo_small_bw,width=1.5cm} \\
  \textsc{Pontifícia Universidade Católica de Minas Gerais}\\
    Departamento de Ciência da Computação
}
\date[]{}

\lstset{language=Java,
   basicstyle=\scriptsize,
   commentstyle=\color{red},
   showstringspaces=false,
   numbers=none,
   numberstyle=\tiny}

\begin{document}


\selectlanguage{brazil}

\begin{frame}
   \titlepage
\end{frame}

%\addtobeamertemplate{frametitle}{}{%
%    \begin{tikzpicture}[remember picture,overlay]
%    \node[anchor=north east,yshift=2pt] at (current page.north east) {\epsfig{file=puclogo_small_bw,width=1.2cm}};
%    \end{tikzpicture}}


%\addtobeamertemplate{frametitle}{}{%
    %\begin{tikzpicture}[node distance=0cm, remember picture, overlay, every node/.style={inner sep=0,outer sep=0, node distance=0cm, baseline=0cm}]
    %\node[anchor=north east] at (current page.north east) {\epsfig{file=puclogo_small_bw,width=1cm}};
    %\end{tikzpicture}}


%\logo{\includegraphics[height=0.8cm]{puclogo_small_bw.pdf}\vspace{220pt}}


\begin{frame}
   \frametitle{Sumário}
   \tableofcontents[pausesections]
\end{frame}

%\AtBeginSection[] % Do nothing for \section*
%{
%\begin{frame}<beamer>
%\frametitle{Outline}
%\tableofcontents[currentsection]
%\end{frame}}


\addtobeamertemplate{frametitle}{}{%
   \begin{textblock*}{10mm}(.9945\textwidth,-1.72cm)
       \includegraphics[height=1cm]{puclogo_small_bw.pdf}
   \end{textblock*}
}

\section{Destrutores}

\begin{frame}[fragile]{\textit{Java Garbage Collector}}
\begin{itemize}
\item Java possui coletor de lixo.
\item Várias variáveis podem apontar para um mesmo objeto.
\item Um objeto é elegível para coleta de lixo quando:
\begin{itemize}
\item não pode mais ser acessado por nenhuma referência;
\item referencia um outro objeto que também o referencia formando um ciclo único e isolado.
\end{itemize}
\end{itemize}    

\end{frame}


\subsection{Finalizando um objeto}

\begin{frame}[fragile]{Finalizando um objeto}
\begin{itemize}
\item Pode ser necessário resolver pendências antes de um objeto ser removido.
\item Quando um objeto vai ser removido pelo coletor de lixo, um método de finalização é executado.
\end{itemize}

\begin{block}{Método \texttt{finalize} da classe \texttt{Object}}
\begin{lstlisting}
   protected void finalize() throws Throwable {
      ...
   }
\end{lstlisting}
\end{block}
\end{frame}

\subsection{Exemplo: Processa Arquivo}

\begin{frame}[fragile]{Exemplo: Processa Arquivo}
\begin{lstlisting}
public class ProcessaArquivo {
   private Stream arq;

   public ProcessaArquivo(String caminho) {
      arq = new Stream(caminho);
   }
   ...
   public void close() {
      if (arq != null) { arq.close(); 
                         arq = null; }
   }
   protected void finalize() throws Thowable {
      super.finalize();
      close();
   }
}
\end{lstlisting}
\end{frame}

\subsection{Exemplo: Classe Produto}
\begin{frame}[fragile]{Exemplo: Destrutor da classe Produto}
\begin{lstlisting}[basicstyle=\tiny]
class Produto {
   private static int instancias = 0;

   public static int getInstancias() {
      return instancias;
   }

   public Produto(String d, float p, int q) {
      instancias++;
   }

   public Produto() {
      instancias++;
   }

   /**
    * É executado quando um objeto está sendo removido da memória.
    */
   @Override
   protected void finalize() throws Throwable {
      super.finalize();
      System.out.println("Finalizando um produto....");
      instancias--;
   }
}
\end{lstlisting}
\end{frame}

\begin{frame}[fragile]{Exemplo: Destrutor da classe Produto}
\begin{lstlisting}[basicstyle=\tiny]
class Aplicacao {
   public static void main(String args[]) {
      System.out.println("\nInstancias prods: " + Produto.getInstancias());

      Produto p1 = new Produto();
      System.out.println("\nInstancias prods: " + Produto.getInstancias());

      Produto p2 = new Produto("Shulambs", 1.99F, 600);
      System.out.println("\nInstancias prods: " + Produto.getInstancias());

      System.out.println("Produto: " + p1.getDescricao());
      System.out.println("Produto: " + p2.getDescricao());

      // Referência p1 aponta para produto da referência p2.
      // produto anteriormente apontado por p1 se torna inacessível.
      p1 = p2;

      System.out.println("Produto: " + p1.getDescricao());
      System.out.println("Produto: " + p2.getDescricao());
      // Coletor de lixo ainda não foi executado.
      System.out.println("\nInstancias prods: " + Produto.getInstancias());

      int i = System.in.read(); // artifício para parar o programa.
      System.gc();
      // Coletor de lixo já foi executado.
      System.out.println("\nInstancias prods: " + Produto.getInstancias());
   }
}
\end{lstlisting}
\end{frame}
    
\section{Herança}

\begin{frame}{Herança}
    \begin{itemize}
    \item Mecanismo para definição de uma classe  em termos de outra classe existente.
    \item Relação: \textit{é um tipo de} / \textit{é um}.
    \item Herança permite o reuso do comportamento de uma classe na definição de outra.
    \item A classe derivada herda todas as características de sua classe base, podendo adicionar novas características.
    \item Baseada em dois princípios fundamentais do projeto de software:
        \begin{itemize}
            \item especificação \textit{(top-down)}
            \item generalização / abstração \textit{(bottom-up)}
        \end{itemize}
    \end{itemize}
\end{frame}

\subsection{Herança simples}

\begin{frame}{Herança Simples}
\begin{itemize}
   \item Novas classes, chamadas de classes derivadas (ou subclasses), são definidas a partir de apenas uma classe base (ou superclasse).
    \item Exemplos:
   \begin{itemize}
   \item Um professor é uma pessoa.
   \item Um ônibus é um veículo.
   \item Um automóvel é um veículo.
   \end{itemize}
    \item Membros da classe base podem ser redefinidos na classe derivada.
   \item Em Java, qualquer classe herda da classe \lstinline|Object|.
   \item Em Java, usa-se a palavra chave \lstinline|extends|, para indicar herança.
\end{itemize}
\end{frame}

\subsection{Construtores em classes estendidas}

\begin{frame}[fragile]{Exemplo: Construtores em classes estendidas}
\begin{lstlisting}
class X {
   protected int mascaraX = 0x00ff;
   protected int mascaraTotal;
   public X() {
      mascaraTotal = mascaraX;
   }
   public int mascara(int orig) {
      return (orig & mascaraTotal);
   }
}

class Y extends X {
   protected int mascaraY = 0xff00;
   public Y() {
      mascaraTotal |= mascaraY;
   }
}
\end{lstlisting}
\end{frame}

\begin{frame}[fragile]{Exemplo: Construtores em classes estendidas}
\begin{lstlisting}

\end{lstlisting}
\begin{itemize}
\item Fases de cada construtor:
   \begin{itemize}
   \item Chamar construtor da superclasse.
   \item Inicializar os campos utilizando suas instruções de inicialização.
   \item Executar corpo do construtor.
   \end{itemize}
\item Digite as classes X e Y e acompanhe os passos de criação com comandos de impressão (use uma classe Aplicacao para isso).
\end{itemize}
\end{frame}

\begin{frame}{Construtores em classes estendidas}
\begin{itemize}
\item Nova classe deve escolher qual construtor da superclasse a chamar.
\item Em um construtor da subclasse pode-se chamar diretamente o construtor da superclasse: \lstinline|super()|.
\item A assinatura
do método \lstinline|super()| deve ser a mesma assinatura do construtor que se deseja chamar.
\item  Se não especificar construtor executa-se chamada ao construtor padrão da classe base (se houver).
\end{itemize}
\end{frame}


\section{Exemplo: Herança de Produto}

\begin{frame}[fragile]{Exemplo: Bem de Consumo}
\begin{lstlisting}
public class BemDeConsumo extends Produto {
   private LocalDate dataValidade;

   public LocalDate getDataValidade() {  return dataValidade;  }
   public void setDataValidade(LocalDate dataValidade) {
      // a data de fabricação deve ser anterior à data de validade.
      if (getDataFabricacao().isBefore(dataValidade.atStartOfDay()))
         this.dataValidade = dataValidade;
   }
   public BemDeConsumo() {
      super();
      // o default é uma validade de 6 meses.
      dataValidade = LocalDate.now().plusMonths(6);
   }
   public BemDeConsumo(String d, float p, int q, 
                       LocalDateTime f, LocalDate v) {
      super(d, p, q, f);
      setDataValidade(v);
   }
}
\end{lstlisting}
\end{frame}

\begin{frame}[fragile]{Exemplo: Bem Durável}
\begin{lstlisting}
public class BemDuravel extends Produto {
   private int mesesGarantia;
   
   public int getMesesGarantia() { return mesesGarantia; }
   public void setMesesGarantia(int mesesGarantia) {
      if (mesesGarantia > 0)
         this.mesesGarantia = mesesGarantia;
   }
   public BemDuravel() {
      super();
      // o valor default é garantia de 6 meses.
      mesesGarantia = 6;
   }
   public BemDuravel(String d, float p, int q, 
                     LocalDateTime f, int g) {
      super(d, p, q, f);
      setMesesGarantia(g);
   }
}
\end{lstlisting}
\end{frame}


\end{document}
